
# This shell snippet gives simple access to rca's floating point
# capability from a POSIX shell.  Use it with "source rca_float".
#
# After including this code, calculate with infix notation lines like this:
#       foo=$(fe "$bar * pi")
# or like this for a conditional expression:
#       if fc "(10 * 3) < $foo"; then ...
#
# These helpers are set up for infix notation:  they provide the outer
# parentheses that rca expects.  Modifying for RPN would be trivial,
# but for just occasional RPN, simply use "reverse parentheses":
#       data="1 2 5 10 -4"; average=$(fe " ) $data avg ( ")
#
# Use RCA_INIT to set common initial conditions.  Defaults are
# provided here, but values set externally will override.

export RCA_INIT="3decimals 0separators 1errorexit ${RCA_INIT:-}"

_rca_run()    # support routine
{
    local output exitcode
    output=$(rca "( $* )" q)
    exitcode=$?

    case $exitcode in
    0|1)
        echo $output
        return $exitcode ;;
    esac

    echo rca failure: $output >&2
    exit $exitcode
}

fe()    # Evaluate a floating point expression.
{
    _rca_run "$*"
    return 0
}

fc()     # Evaluate a floating point conditional expression.
{
    _rca_run "$*" >/dev/null
}

